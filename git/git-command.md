# Gitまとめ

---

## Git コマンド一覧

### git status

- 変更があるファイルがあるかどうか、変更状況を確認する

### ls

- 現在のディレクトリに格納されているファイル一覧を表示（隠しファイルも含めて表示する場合は -a を追記して実行する）

### git clone https:~.git

- 指定したURLのリモートリポジトリの内容を複製する

### git add index.html

- `index.html`ファイルをステージに追加する

### git diff

- ステージに追加**する前の**ファイルの変更差分を確認する

### git commit index.html

- ステージに追加した `index.html`ファイルをコミット（リモートリポジトリへ反映する準備）する

### git diff --staged

- ステージに追加**した後の**ファイルの変更差分を確認する

### git log

- 変更履歴を全て表示する

### git log --oneline

- 変更履歴を各一行で表示

### git rm index.html

- `index.html`ファイルをローカルリポジトリも併せて削除する

### git rm -r hoge

- `hoge`ディレクトリを削除する

### git rm --cached index.html

- `index.html`ファイルをローカルリポジトリのみ削除する

### git rm -r --cached ．

- ローカル環境は残しつつ、キャッシュを全て削除する（ローカルリポジトリの管理情報のみ削除する）

### git checkout -- index.html

- ステージに追加する前の`index.html`ファイルの変更を取り消す

### git reset HEAD index.html

- ステージに追加した`index.html`ファイルをステージから降ろす

### git remote

- リモートの状態を表示

### git remote -v

- リモートの対応するURLを表示

### git remote add origin https:~.git

- GitHubに登録されているリモートリポジトリ（URL）に`origin`という名前でGitHubにアップしたり取得できるように紐づけ登録する（基本的に初回のみ使用）

### git remote show origin

- `origin`リモートリポジトリの詳細を表示する
- `git push`するとリモートリポジトリのどのブランチに反映されるかも表示される
- 現在利用されている、存在しているブランチは`tracked`、削除されているブランチは`stale`と表示される

### git remote prune origin

- `git remote show origin`で`stale`と表示されているブランチを一斉削除する
- 事前確認したい場合は`--dry-run`を追記して実行する（最終行に削除されるブランチが表示される）

### git push origin master

- `origin`というリモートリポジトリの`master`というブランチにローカルリポジトリの変更を反映する
- リモートリポジトリに指定のブランチがなければ同時に作成される

### git fetch origin

- `origin`リモートリポジトリの内容をローカルリポジトリ（remotes/origin/master）に取得してくる（取得するだけでマージはまだされていない）
- `fetch`して取得した`origin`リモートリポジトリの内容を確認する場合は `git checkout remotes/origin/master` で切り替える
- 問題なければ作業しているブランチに戻って `git merge origin/master` でマージする（`fetch`で取得したリモートリポジトリ `remotes/origin/master` をマージ）

### git pull origin master

- `origin`リモートリポジトリの`master`ブランチの内容をローカルリポジトリに取得し、自動でマージまで行う
- ローカルの作業ブランチが取得したリモートリポジトリのブランチが異なると意図しない反映が行われてしまう
- 例．リモート：`hoge`ブランチ、ローカル：`master`ブランチの場合、git pullすると**`hoge`ブランチの内容がローカルの`hoge`ブランチではなく`master`ブランチに反映される**
- 上記の事故が起こる可能性があるので、基本的に`git fetch`を使うことが推奨される

### git pull --rebase origin master

- `git pull origin maseter`を実行すると`fetch`して`merge`するのに対して、`--rebase`を挟むことで`merge`の代わりに`rebase`してリモートリポジトリの情報を取得する
- 通常はマージコミットができるため記録を残したい場合に使い、逆にリモートリポジトリの情報を取得するだけの場合は`--rebase`を使う

### git branch

- ブランチの一覧を表示する

### git branch -a

- リモートリポジトリの情報を含めたブランチの一覧を表示する

### git branch hoge

- 新規に`hoge`ブランチを作成する（切り替えは行われない）

### git branch hoge origin/hoge

- `origin`リモートリポジトリの`hoge`ブランチを使ってローカルに`hoge`ブランチを作成する
- 上記のコマンドを使う前にリモートリポジトリからデータを取得しておく必要がある（最新の状態にするため）

### git branch -d hoge

- `hoge`ブランチを削除する（マージされていない変更点がある場合は削除できない）
- 強制的に削除する場合は`git branch -D hoge`を実行する

### git checkout -b hoge

- 新規に`hoge`ブランチを作成し、そのブランチに切り替える

### git checkout -b foo ed9b224

- コミットのハッシュ値を指定することで、過去のコミットに遡って任意のブランチ（上記では`foo`ブランチ）を作成して切り替える

### git checkout hoge

- 作業ブランチを`hoge`ブランチに移動する
- 変更されたファイルがある状態で移動しようとするとエラーになるため、コミットして変更差分を解消する必要がある

### git merge hoge

- `hoge`ブランチで行われたファイルの変更を現在いるブランチに統合する（ブランチによる枝分かれをまとめる）
- そのためまとめたいベースとなるブランチにいるかどうか確認しておく必要がある
- マージには3種類ある

1. `Fast Foward`（早送りマージ）：ブランチによる枝分かれがない状態でマージすることで行われる
2. `Auto Merge`（基本的なマージ）：ブランチによる枝分かれがある状態で行われるマージ
3. `Conflict`（変更の衝突）：それぞれのブランチで同じファイルの同じ行に対して変更を行ったことで、マージしたときにどちらを反映すればよいか判断できない状態のこと
  
- コンフリクトが発生した場合は対象のファイルを修正してコミットし直す必要がある

### git rebase master

- コミット履歴を、枝分かれするマージと違い、枝分かれさせることなく整理して統合する
- `git merge`では取り込み元のブランチに移動して取り込みたいブランチを指定して実行することに対して、`git rebase`では取り込みたいブランチに移動して取り込み元のブランチを指定して実行する
- 上記のコマンドを実行した場合、枝分かれしていた作業ブランチが`master`ブランチが指し示すコミットを親として作成された子コミットに移動する（一直線になる）。`master`ブランチは最新状態ではないので別途`git merge`コマンドが必要になる

### git rebase -i HEAD~3

- 最新のコミットから遡ってコミット内容を修正する
- 上記のが場合、最新コミット（HEAD）から3つ目までを対象として修正することができる
- 実行すると各コミットメッセージが羅列され、それぞれ文頭に`Pick`が表示されるので、INSERTモードにして修正したいコミットの`Pick`を`edit`に書き換えて保存する
- この時ブランチ名の隣に`REBASE`と表示され、修正モードに入っていることを示している
- その後実行するコマンドを教えてくれるが、修正点があれば`git commit --amend`を実行して修正を行う
- 各修正が完了するたび`git rebase --continue`を実行していき、`REBASE`の表示が消えたら修正は無事終了となる

---

## 開発におけるブランチの運用

- `master`ブランチをリリース用に、開発には別途ブランチを作成して、最終的に`master`ブランチにマージするという流れで行うことが推奨される

### 開発フロー

1. `git branch hoge`もしくは`git checkout -b hoge`で作業ブランチを作成・移動する
2. 作業ブランチで開発を進めてコミットする
3. 開発が終了したら`git checkout master`で`master`ブランチに移動する
4. `git marge hoge`で`hoge`ブランチで行われた変更点を`master`ブランチにマージする
5. 1～4を繰り返す
